<!doctype html>
<html lang="en">
<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <meta charset="UTF-8">
    <meta http-equiv="x-ua-compatible" content="IE-edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wetter</title>



</head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
    <style>
    tr:hover{
    background-color: #f6d8b3;
    }

    </style>


<script>
        function countdown() {
            const startingMinutes = 30;
            let time = startingMinutes * 60;
            const countdownElement = document.getElementById('countdown');

            setInterval(updateCountdown, 1000);

            function updateCountdown() {
                const minutes = Math.floor(time / 60);
                let seconds = time % 60;
                countdownElement.innerHTML = `${minutes}: ${seconds}`;
                time--;

            }
        }

        function post(){

           let url = "http://limla.ml:8080/api/v1/weather/new";

           let xhr = new XMLHttpRequest();
            xhr.open("POST", url,true);

            xhr.setRequestHeader("Accept", "application/json");
            xhr.setRequestHeader("Content-Type", "application/json");

            xhr.onreadystatechange = function () {
                if (xhr.readyState === 4) {
                    console.log(xhr.status);
                    console.log(xhr.responseText);
                }
            };

            const data = {
                "airtemp": document.getElementById('luftt').value,
                "cond": document.getElementById('streckenv').value,
                "tracktemp": document.getElementById('streckent').value
            }

            xhr.send(JSON.stringify(data));

        }

      function createDiagramm() {
          let url = "http://limla.ml:8080/api/v1/weather/all";

          let xhr = new XMLHttpRequest();
          xhr.open("GET", url, true);
          xhr.send();
          xhr.onreadystatechange = function () {
              if (xhr.readyState == 4 && this.status == 200) {
                  var data = JSON.parse(this.responseText);


                  var time = data.map(function (elem) {
                      return elem.time;
                  });

                  var air = data.map(function (elem) {
                      return elem.airtemperatur;
                  });

                  var track = data.map(function (elem) {
                      return elem.tracktemperatur;
                  });


                  var ctx = document.getElementById('canvas').getContext('2d');
                  var myChart = new Chart(ctx, {
                      type: 'line',
                      data: {
                          labels: time,
                          datasets: [{
                              label: 'Lufttemperatur',
                              data: air,
                              backgroundColor: 'transparent',
                              borderColor: 'red',
                              borderWidth: 4
                          },
                              {
                                  label: 'Streckentemperatur',
                                  data: track,
                                  backgroundColor: 'transparent',
                                  borderColor: 'green',
                                  borderWidth: 4

                              }]
                      },
                      options: {
                          elements: {
                              line: {
                                  tension: 0
                              }
                          },
                          scale: {
                              yAxes: [{
                                  ticks: {
                                      beginAtZero: true
                                  }
                              }]
                          }
                      }
                  });
              }
          }
      }











        function addValues() {

            let lufttemp = document.getElementById('luftt').value;
            let streckentemp = document.getElementById('streckent').value;
            let streckenv = document.getElementById('streckenv').value;
            post();
            countdown();
            addTable();
            createDiagramm();


        }


        function addTable(){
        $(document).ready(function(){
            $.getJSON('http://limla.ml:8080/api/v1/weather/all',
                function(json){
                var table = document.getElementById('myTable');

                for(let i=0; i<json.length;i++){

                    var row = `<tr>
							<td>${json[i].date}</td>
							<td>${json[i].time}</td>
							<td>${json[i].airtemperatur}</td>
							<td>${json[i].tracktemperatur}</td>
							<td>${json[i].weatherConditions}</td>
					  </tr>`
                    table.innerHTML += row


                }
                })

                })
        }





</script>

</head>

<body>



<!-- Navigationsleiste-->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark text-white">
    <div class="container-fluid">
        <a class="navbar-brand" href="Übersicht.html">Land Motorsport</a>
        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-md-0">
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="Übersicht.html">Übersicht</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="Bestellung.html">Bestellung</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="Wetter.html">Wetter</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" aria-current="page" href="Reifen.html">Reifen</a>
                </li>
            </ul>
            <div class="dropdown">
                <a href="#" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdown" data-bs-toggle="dropdown" aria-expanded="true">
                    <strong>Benutzername</strong>
                </a>
                <ul class="dropdown-menu dropdown-menu-dark">
                    <li>

                        <a class="dropdown-item dark" href="Profil.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person mb-1" viewBox="0 0 16 16">
                                <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"/>
                            </svg>   Profil
                        </a>
                    </li>
                    <li>
                        <a class="dropdown-item dark" href="Login.html">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-door-open" viewBox="0 0 16 16">
                                <path d="M8.5 10c-.276 0-.5-.448-.5-1s.224-1 .5-1 .5.448.5 1-.224 1-.5 1z"/>
                                <path d="M10.828.122A.5.5 0 0 1 11 .5V1h.5A1.5 1.5 0 0 1 13 2.5V15h1.5a.5.5 0 0 1 0 1h-13a.5.5 0 0 1 0-1H3V1.5a.5.5 0 0 1 .43-.495l7-1a.5.5 0 0 1 .398.117zM11.5 2H11v13h1V2.5a.5.5 0 0 0-.5-.5zM4 1.934V15h6V1.077l-6 .857z"/>
                            </svg> Ausloggen
                        </a>
                    </li>

                </ul>
            </div>
        </div>
    </div>
</nav>
<!-- Wettereingabe -->


<div style="margin-left: inherit" "">
    <p  id="countdown">30:00</p>

</div>

<div class="container mt-2">
    <div class="row">
   <!--     <div class="col-sm-2">
            <label class="form-label">Datum</label>
            <input style="margin-top: 7px" type="date" name="datum" id="datum" class="from-control">
        </div>

        <div class="col-sm-2">
            <label class="from-label">Uhrzeit</label>
            <br>
            <input style="margin-top: 15px" type="time" name="uhrzeit" id="zeit" class="from-control">
        </div> -->

        <div style="position: -ms-device-fixed" class="col-sm-2">
            <label  class="form-label">Lufttemperatur in °C</label>
            <input style="margin-top: 7px" type="number" name="lufttemperatur" id="luftt" class="from-control">
        </div>
        <div class="col-sm-2">
            <label class="form-label">Streckentemperatur in °C</label>
            <input type="number" name="streckentemperatur" id="streckent"class="from-control">

        </div>
        <div class="col-md-2">
            <label  class="form-label">Streckenverhältnis</label>
            <select  name="streckenverhätnis" id="streckenv" class="form-select">
                <option value>Streckenverhätnis auswählen</option>
                <option>wet</option>
                <option>dry</option>
                <option>drying off</option>
                <option>drizzle</option>
                <option>sunny</option>
                <option>cloudy</option>
            </select>
        </div>
        <div class="col-md-2 pt-2">
            <button id="bt1" onClick="addValues()"class="btn btn-primary btn-md mt-4">Eintragen</button>
        </div>

    </div>
</div>



<!-- Wetterdaten -->

<div class="container-flex p-3">
    <h3>Wetterdaten</h3>
    <br>
    <table class="table table-striped table-sm" id='wetterdaten'>
        <thead>
            <tr>
                <th id="d">Datum </th>
                <th id="u">Uhrzeit</th>
                <th id="l">Lufttemperatur in °C</th>
                <th id="s">Streckentemperatur in °C</th>
                <th id="sv">Streckenverhätnis</th>
            </tr>
        </thead>
        <tbody
            id="myTable">
        </tbody>

    </table>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.6.2/chart.min.js"></script>

<div class="container">
    <style>

        .container{
            width: 85%;
        }
        h1{
            text-align: center;
            font-size:20px
        }
        #canvas{
            width: 100%;
        }
    </style>
    <h1>Luft und Streckentemperatur </h1>
    <div>
        <canvas id="canvas"></canvas>
    </div>


</div>
<script>

</script>

</body>
</html>
